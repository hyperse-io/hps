---
icon: BrushIcon
---

# CLI Commands

## Command Architecture

The HPS CLI provides commands through a plugin-based architecture. Each command is registered by a plugin during CLI initialization.

### Command Registration Flow

```mermaid
graph TB
    CLI["createWizard()<br/>packages/hps/src/index.ts:41"]

    subgraph "Wizard Framework Plugins"
        HELP["helpPlugin<br/>--help flag"]
        VERSION["versionPlugin<br/>--version flag"]
        COMPLETION["completionPlugin<br/>completion command"]
        ERROR["errorPlugin<br/>Error handling"]
        LOADER["loaderPlugin<br/>Dynamic plugin loading"]
    end

    subgraph "Feature Plugins"
        INFO["infoPlugin<br/>info command"]
        DEPLOY["deployPlugin<br/>deploy command"]
        UPDATE["updatePlugin<br/>update command"]
        BUILD["buildPlugin<br/>build command"]
        SERVE["servePlugin<br/>serve command"]
        MOCK["mockPlugin<br/>mock command"]
    end

    CLI --> HELP
    CLI --> VERSION
    CLI --> COMPLETION
    CLI --> ERROR
    CLI --> LOADER
    CLI --> INFO
    CLI --> DEPLOY
    CLI --> UPDATE
    CLI --> BUILD
    CLI --> SERVE
    CLI --> MOCK

    INFO --> INFO_CMD["Display system info"]
    DEPLOY --> DEPLOY_CMD["Deploy to cloud"]
    UPDATE --> UPDATE_CMD["Update dependencies"]
    BUILD --> BUILD_CMD["Production build"]
    SERVE --> SERVE_CMD["Development server"]
    MOCK --> MOCK_CMD["Start mock server"]
```

## Global Options

All commands support the following global options inherited from the Wizard framework:

| Option       | Description                               | Type    |
| ------------ | ----------------------------------------- | ------- |
| `--help`     | Display help information for a command    | boolean |
| `--version`  | Display CLI version                       | boolean |
| `--no-color` | Disable colored output                    | boolean |
| `--locale`   | Set locale for internationalized messages | string  |

## Built-in Commands

### `completion`

Generate shell completion scripts for the HPS CLI.

**Syntax:**

```bash
hps completion [shell]
```

**Description:**
Generates shell completion scripts for bash, zsh, or fish shells. This enables tab-completion for HPS commands and options.

**Usage:**

```bash
# Generate completion script
hps completion

# Install completion for current shell
hps completion >> ~/.bashrc
```

## Information Commands

### `info`

Display system information, CLI version, and platform dependencies.

**Syntax:**

```bash
hps info
```

**Description:**
Prints comprehensive information about the HPS CLI installation, including:

- CLI version
- System information (OS, Node.js version)
- @hyperse platform dependencies

**Output Sections:**

```mermaid
graph LR
    INFO["info command"]

    INFO --> BANNER["printBanner()<br/>ASCII banner"]
    INFO --> CLI_VER["printCliVersion()<br/>CLI version info"]
    INFO --> SYS_INFO["printSystemInformation()<br/>OS and Node version"]
    INFO --> DEPS["printDependency()<br/>@hyperse packages"]

    CLI_VER --> PKG["cliPackage.version"]
    DEPS --> PKG_DEPS["cliPackage.dependencies<br/>cliPackage.devDependencies<br/>cliPackage.peerDependencies"]
```

**Example Output:**

```bash
  _  _  _    _   ___   ___   ___   ___   ___
 | || | \ \ / / | _ \ | __| | _ \ / __| | __|
 | __ |  \ V /  |  _/ | _|  |   / \__ \ | _|
 |_||_|   |_|   |_|   |___| |_|_\ |___/ |___|


  ✨ Next-Generation CLI • Powered by Hyperse

  ✔ @hyperse CLI
   @hyperse CLI Version : 0.1.0-next.25


  ✔ System Information
   OS Version     :  macOS Tahoe
   NodeJS Version :  v22.13.1

  ✔ @hyperse Platform Information
   wizard-plugin-completion ➞ version : 1.0.3
   wizard-plugin-version ➞ version    : 1.0.6
   eslint-config-hyperse ➞ version    : 1.4.8
   wizard-plugin-loader ➞ version     : 1.0.6
   wizard-plugin-error ➞ version      : 1.0.6
   wizard-plugin-help ➞ version       : 1.0.6
   ...
```

**Package Structure:**

| Function                   | Purpose                  |
| -------------------------- | ------------------------ |
| `createInfoPlugin()`       | Plugin factory           |
| `printBanner()`            | Display ASCII banner     |
| `printCliVersion()`        | Show CLI version         |
| `printSystemInformation()` | Show OS and Node version |
| `printDependency()`        | List @hyperse packages   |

---

## Development Commands

### `serve`

Start the development server with hot module replacement and optional API mocking.

**Syntax:**

```bash
hps serve [entry] [options]
```

**Arguments:**
| Argument | Description | Required | Default |
|----------|-------------|----------|---------|
| `entry` | Entry name to serve (maps to entry in configuration) | No | All entries |

**Options:**
| Option | Description | Type | Default |
|--------|-------------|------|---------|
| `--projectCwd` | Project working directory | string | `process.cwd()` |

**Description:**
Starts a development server with Rspack bundler integration, providing:

- Hot Module Replacement (HMR)
- React Fast Refresh
- TypeScript type checking
- GraphQL API mocking (if configured)
- Static page serving

**Example Usage:**

```bash
# Start dev server for all entries
hps serve

# Start dev server for specific entry
hps serve evolve

# Use custom project directory
hps serve evolve --projectCwd /path/to/project
```

**Integration with Services:**

```mermaid
graph TB
    SERVE["hps serve<br/>packages/hps-plugin-serve"]

    SERVE --> RSPACK["hps-srv-rspack<br/>Bundler integration"]
    SERVE --> MOCK["hps-srv-mock<br/>GraphQL mocking"]
    SERVE --> TS_CHECKER["hps-srv-ts-checker<br/>Type validation"]

    RSPACK --> DEV_SERVER["@rspack/dev-server<br/>HTTP server"]
    RSPACK --> HMR["React Fast Refresh<br/>Hot reloading"]
    RSPACK --> LOADERS["Asset loaders<br/>CSS, LESS, images"]

    MOCK --> GRAPHQL["GraphQL middleware<br/>Mock resolvers"]
    MOCK --> HTTP_PROXY["HTTP proxy<br/>Bypass to backend"]

    TS_CHECKER --> COMPILER["TypeScript compiler<br/>Continuous validation"]
```

**Configuration:**
The serve command uses configuration from `hps-evolve.config.ts`. See [Dev Server Options](#5.2) for detailed configuration options.

### `build`

Create an optimized production build.

**Syntax:**

```bash
hps build [entry] [options]
```

**Arguments:**
| Argument | Description | Required | Default |
|----------|-------------|----------|---------|
| `entry` | Entry name to build (maps to entry in configuration) | No | All entries |

**Description:**
Executes a production build using Rspack or Rolldown bundler, applying:

- Code minification
- Tree shaking
- Code splitting with configurable chunk sizes
- CSS extraction and optimization
- Circular dependency detection
- Source map generation

**Example Usage:**

```bash
# Build all entries
hps build

# Build specific entry
hps build evolve
```

**Build Pipeline Flow:**

```mermaid
graph LR
    BUILD["hps build"]

    BUILD --> CONFIG["Load configuration<br/>hps-evolve.config.ts"]
    CONFIG --> ENTRY["Resolve entries<br/>Entry map"]

    ENTRY --> RSPACK_BUILD["Rspack build<br/>or Rolldown build"]

    RSPACK_BUILD --> LOADERS["Asset processing<br/>CSS, LESS, images"]
    RSPACK_BUILD --> PLUGINS["Rspack plugins<br/>HTML, extract, optimize"]

    LOADERS --> OPTIMIZE["Optimization<br/>Minify, split, circular-dep-check"]
    PLUGINS --> OPTIMIZE

    OPTIMIZE --> OUTPUT["Output<br/>dist/ directory"]
```

**Integration with Services:**

- Bundler service: [hps-srv-rspack](#4.1) or [hps-srv-rolldown](#4.4)
- TypeScript checking: [hps-srv-ts-checker](#4.3)
- Common utilities: [hps-srv-common](#4.5)

**Output:**
Production-optimized bundles are written to the `dist/` directory by default. See [Output Configuration](#6.3) for details.

### `mock`

Start a standalone GraphQL mock server for API development.

**Syntax:**

```bash
hps mock [options]
```

**Description:**
Starts a dedicated mock server for GraphQL APIs without running the full development server. Useful for:

- Backend team development
- API contract testing
- Frontend development without backend dependency

The mock server uses configuration from `hps-mock.config.ts` to determine:

- GraphQL endpoints and priorities
- Mock vs. bypass strategies
- Operation-level overrides
- Schema introspection

**Configuration:**
Mock configuration is defined using `defineGraphqlMock()` helper. See [Mock Configuration](#4.2.2) for details.

---

## Utility Commands

### `deploy`

Deploy build artifacts to cloud storage (Aliyun OSS).

**Syntax:**

```bash
hps deploy [options]
```

**Description:**
Uploads build artifacts from the `dist/` directory to Aliyun OSS (Object Storage Service). Supports:

- Recursive directory upload
- MIME type detection
- Progress indication
- Custom path prefixes

**Options:**
Configuration is typically provided through `hps-evolve.config.ts` under the `deploy` section, including:

- OSS credentials
- Bucket name
- Region
- Relative path prefix

### `update`

Update workspace dependencies to their latest versions.

**Syntax:**

```bash
hps update [options]
```

**Options:**
| Option | Description | Type | Default |
|--------|-------------|------|---------|
| `--deep` | Enable recursive updates across workspace packages | boolean | `false` |

**Description:**
Updates package dependencies using `npm-check-updates` to find and upgrade to the latest versions. In monorepo setups, processes all workspace packages.

**Features:**

- Detects Yarn workspaces using `@manypkg/get-packages`
- Updates `package.json` files
- Supports both shallow (direct dependencies) and deep (recursive) updates
- Preserves package manager lockfile

**Example Usage:**

```bash
# Update dependencies in current package
hps update

# Recursive update across all workspace packages
hps update --deep
```

## Command Execution Context

### Interceptor Chain

All commands execute through an interceptor chain that sets up common context:

```mermaid
graph TB
    CMD["Command invoked<br/>e.g., hps serve"]

    CMD --> LOGGER["Setup logger<br/>commonLogger.setupCommonLogger()"]
    LOGGER --> LOAD_CONFIG["Load configuration<br/>hps-evolve.config.ts"]
    LOAD_CONFIG --> PLUGIN_HANDLER["Plugin command handler<br/>Command-specific logic"]
    PLUGIN_HANDLER --> CLEANUP["Cleanup<br/>Post-execution"]

    subgraph "Common Context"
        LOGGER_CTX["ctx.logger<br/>Shared across all services"]
        CONFIG_CTX["ctx.config<br/>Loaded configuration"]
        FLAGS_CTX["ctx.flags<br/>Parsed command-line options"]
    end

    LOGGER --> LOGGER_CTX
    LOAD_CONFIG --> CONFIG_CTX
    CMD --> FLAGS_CTX
```

**Interceptor Setup:**
The common logger is configured globally for all commands at [packages/hps/src/index.ts:55-64](), ensuring consistent logging across plugins and services.

```typescript
// Interceptor that runs before all commands
wizard.interceptor(async (ctx, next) => {
  commonLogger.setupCommonLogger(ctx.logger);
  await next();
});
```

**Configuration Loading:**
Configuration is loaded using `@hyperse/config-loader` with the following settings:

- Config file pattern: `hps`
- Supported formats: `.ts`, `.js`, `.mjs`
- Externals: All `@hyperse/*` packages are treated as external

---

## Command to Plugin Mapping

The following table shows how commands map to their implementing plugins:

| Command      | Plugin Package                      | Factory Function           |
| ------------ | ----------------------------------- | -------------------------- |
| `info`       | `@hyperse/hps-plugin-info`          | `createInfoPlugin()`       |
| `deploy`     | `@hyperse/hps-plugin-deploy`        | `createDeployPlugin()`     |
| `update`     | `@hyperse/hps-plugin-update`        | `createUpdatePlugin()`     |
| `build`      | `@hyperse/hps-plugin-build`         | `createBuildPlugin()`      |
| `serve`      | `@hyperse/hps-plugin-serve`         | `createServePlugin()`      |
| `mock`       | `@hyperse/hps-plugin-mock`          | `createMockPlugin()`       |
| `completion` | `@hyperse/wizard-plugin-completion` | `createCompletionPlugin()` |
